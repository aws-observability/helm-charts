{{- if .Values.containerLogs.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-windows-config
  namespace: {{ .Release.Namespace }}
  labels:
    k8s-app: fluent-bit
data:
  fluent-bit.conf: |
    {{- if .Values.useDualstackEndpoint }}
    {{- .Values.containerLogs.fluentBit.configWindows.service | replace "Parsers_File                parsers.conf" (printf "Parsers_File                parsers.conf\n  net.dns.prefer_ipv6       true") | nindent 4 }}
    {{- else }}
    {{- .Values.containerLogs.fluentBit.configWindows.service  | nindent 4 }}
    {{- end }}
    {{- range $key, $val := .Values.containerLogs.fluentBit.configWindows.extraFiles }}
    @INCLUDE {{ $key }}
    {{- end }}
  parsers.conf: |
    {{- .Values.containerLogs.fluentBit.configWindows.customParsers  | nindent 4 }}
  {{- range $key, $val := .Values.containerLogs.fluentBit.configWindows.extraFiles }}
  {{ $key }}: |
    {{- include "fluent-bit.add-dualstack-endpoints" (dict "Values" $.Values "config" (tpl $val $)) | nindent 4 }}
  {{- end -}}
{{- end -}}